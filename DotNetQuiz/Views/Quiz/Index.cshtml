@{
    ViewBag.Title = "Index.cshtml";
    Layout = "~/Views/Shared/_NewLayout.cshtml";
      
}
@model DotNetQuiz.Models.Question


@section AdditionalScripts{
<script src="@Url.Content("~/Scripts/jquery.tmpl.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.cookie.js")" type="text/javascript"></script>


}
<section id="questionBox">
<div id="question">
</div>

@using (Html.BeginForm())
{
    <div id="answerOptions">

     </div>
    <div id="answerBtnBox">
        <input  id="btnAnswer" type="submit" value="Answer" />
    </div>
}
</section>

<section id="answerBox" style="display: none">
<div id="succesBox"></div>
<div id="messageBox"></div>
<div>
<input type="button" id="btnNextQuestion" onclick="quiz.GetQuestion(); "/>
</div>
</section>

@section footer{}

@section scripts
{

<script id="answerOptionsTemplate" type="text/x-jquery-tmpl">

        <div class="answer">
            <input type="radio" value=${Item1} name="Answer" id="Answer"> ${Item2}
        </div>
</script>
<script type="text/javascript">

    var questionData = { question: 0, answer: 0 };
    var quiz = new Quiz();

    $(document).ready(function () {
        quiz.GetQuizStatus();
    });
    



$(function () {
    $('form').submit(function () {
        $.ajax({
            url: "Quiz/Answer",
            type: "POST",
            data: questionData,
            dataType: "json",

            success: function (result) {
                $('#questionBox').hide();
                var answer = $('#answerBox');
                answer.show();
                if (result.correct == false) {
                    answer.find('#succesBox').text("Answer was incorrect");
                    answer.find('#messageBox').text(result.message);
                }

            }
        });
        return false;
    });
});


function Quiz()
{
    var quizId;
    var startTime;
    var currentQuestionId;
    var currentAnswerId;
    var me = this;

    Quiz.prototype.GetQuestion = function () {
        $.ajax({
            url: "Quiz/NextQuestion",
            type: "POST",
            data: quizId,
            dataType: "json",

            success: function (result) {
                var answer = $('#answerBox');
                answer.hide();
                var qBox = $('#questionBox');
                qBox.find('#question').text(result.QuestionText);
                var answerOptions = $('#answerOptions');
                answerOptions.empty();
                $('#answerOptionsTemplate').tmpl(result.AnswerOptions).appendTo(answerOptions);

                qBox.show();
            }


        });
    };


    Quiz.prototype.StartNewQuiz = function() {

        $.ajax({
                url: "Quiz/NewQuiz",
                type: "POST",
                datatype: "json",

                success: function(result) {
                    quizId = result.QuizId;
                    me.startTime = result.StartTime;
                    me.GetQuestion();
                }

            });
        };

        Quiz.prototype.GetQuizStatus = function () {

            var id = $.cookie('DotNetQuiz');

            if (id != null) {

                this.quizId = parseInt(id);

                $.ajax({
                    url: "Quiz/QuizStatus",
                    type: "POST",
                    data: { quizId: me.quizId },
                    datatype: "json",
                    success: function (result) {
                        me.startTime = result.StartTime;
                        me.GetQuestion();
                    },
                    failure: function (result) {
                        alert('Could not get Quiz status');
                    }
                });
            } else {
                me.StartNewQuiz();
            }
        };
    

}

</script>
}